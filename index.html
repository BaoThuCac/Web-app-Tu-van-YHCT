<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T∆∞ v·∫•n Y h·ªçc C·ªï truy·ªÅn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0fdf4; /* N·ªÅn xanh l√° nh·∫°t */
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white rounded-3xl shadow-2xl p-8 max-w-2xl w-full border border-green-200">
        <!-- Logo ƒë√£ ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
        <div class="flex justify-center mb-4">
            <img src="https://lh3.googleusercontent.com/OGGDgoEAsCpKpWVQvCXuMrjPRBkF6sfAzKXI-NWEY3hlTTsd5kEHHWGRi4plmZCMpgQf7LUSHCscaxUqwx_k8T5R5sGmJxBX1f69IX4xjHlS42UyauM-DmnECuEBzIHl8Z8qfJmKFW8=w16383" alt="Logo" class="h-20 w-20 rounded-full border-2 border-green-500 shadow-md">
        </div>
        
        <h1 class="text-3xl font-bold text-center text-green-800 mb-2">
            <span class="text-4xl">üåø</span>
            T∆∞ v·∫•n Y h·ªçc C·ªï truy·ªÅn
            <span class="text-4xl">üåø</span>
        </h1>
        
        <!-- Added a prominent, easy-to-see link below the title -->
        <div class="text-center mb-6">
            <a href="https://sites.google.com/view/baothucac" class="text-lg font-bold text-green-700 hover:text-green-500 hover:underline transition-colors duration-300">
                B·∫£o Th∆∞ C√°c
            </a>
        </div>

        <p class="text-center text-gray-600 mb-8">
            H√£y m√¥ t·∫£ tri·ªáu ch·ª©ng c·ªßa b·∫°n, ho·∫∑c h·ªèi v·ªÅ m·ªôt ph∆∞∆°ng ph√°p tr·ªã li·ªáu, v√† nh·∫≠n l·ªùi khuy√™n d·ª±a tr√™n Y h·ªçc C·ªï truy·ªÅn.
        </p>
        
        <!-- The API Key input field has been removed to hide it from the user -->

        <div class="mb-6">
            <textarea
                id="symptom-input"
                class="w-full h-32 p-4 border border-green-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 transition-all resize-none"
                placeholder="V√≠ d·ª•: 'T√¥i th∆∞·ªùng xuy√™n ƒëau ƒë·∫ßu, ch√≥ng m·∫∑t v√† kh√≥ ng·ªß. Xin cho l·ªùi khuy√™n theo YHCT.'"
            ></textarea>
        </div>

        <div class="flex justify-center mb-6">
            <button
                id="consult-button"
                class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-full transition-all shadow-lg active:scale-95 focus:outline-none focus:ring-2 focus:ring-green-500 flex items-center justify-center"
            >
                <span id="button-text">T∆∞ v·∫•n t·ª´ chuy√™n gia YHCT ‚ú®</span>
                <div id="loading-spinner" class="hidden ml-2 w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
            </button>
        </div>

        <div id="response-area" class="mt-8 p-6 bg-green-50 rounded-xl border border-green-300 hidden">
            <h2 class="text-xl font-bold text-green-800 mb-4 flex items-center">
                <span class="mr-2 text-2xl">üë©‚Äç‚öïÔ∏è</span> K·∫øt qu·∫£ t∆∞ v·∫•n:
            </h2>
            <div id="response-content" class="text-gray-700 leading-relaxed whitespace-pre-wrap"></div>
        </div>
        
        <div id="error-message" class="hidden mt-4 text-center text-red-600">
            ƒê√£ x·∫£y ra l·ªói. Vui l√≤ng th·ª≠ l·∫°i sau.
        </div>
    </div>

    <script>
        // G·∫Øn c·ª©ng API Key tr·ª±c ti·∫øp v√†o m√£ ngu·ªìn
        const apiKey = "AIzaSyC1gl0Sj_IGMDqfEXkdUKQ9mEfNNA6KXWs";

        // L·∫•y c√°c ph·∫ßn t·ª≠ DOM
        const symptomInput = document.getElementById('symptom-input');
        const consultButton = document.getElementById('consult-button');
        const buttonText = document.getElementById('button-text');
        const loadingSpinner = document.getElementById('loading-spinner');
        const responseArea = document.getElementById('response-area');
        const responseContent = document.getElementById('response-content');
        const errorMessage = document.getElementById('error-message');

        // Th√™m tr√¨nh nghe s·ª± ki·ªán cho n√∫t "T∆∞ v·∫•n"
        consultButton.addEventListener('click', async () => {
            const userSymptom = symptomInput.value.trim();

            if (!userSymptom) {
                // Ch·ªâ ki·ªÉm tra tr∆∞·ªùng tri·ªáu ch·ª©ng v√¨ API Key ƒë√£ ƒë∆∞·ª£c g·∫Øn c·ª©ng
                alert('Vui l√≤ng nh·∫≠p tri·ªáu ch·ª©ng ho·∫∑c c√¢u h·ªèi c·ªßa b·∫°n.');
                return;
            }

            // Hi·ªÉn th·ªã tr·∫°ng th√°i t·∫£i v√† ·∫©n c√°c khu v·ª±c kh√°c
            consultButton.disabled = true;
            buttonText.textContent = 'ƒêang t∆∞ v·∫•n...';
            loadingSpinner.classList.remove('hidden');
            responseArea.classList.add('hidden');
            errorMessage.classList.add('hidden');
            responseContent.textContent = '';

            try {
                // T·∫°o prompt cho m√¥ h√¨nh Gemini
                const prompt = `B·∫°n l√† m·ªôt b√°c sƒ© Y h·ªçc C·ªï truy·ªÅn gi√†u kinh nghi·ªám. H√£y cung c·∫•p m·ªôt l·ªùi khuy√™n ng·∫Øn g·ªçn v√† chuy√™n nghi·ªáp d·ª±a tr√™n nguy√™n t·∫Øc Y h·ªçc C·ªï truy·ªÅn cho v·∫•n ƒë·ªÅ sau ƒë√¢y. L∆∞u √Ω r·∫±ng ƒë√¢y ch·ªâ l√† l·ªùi khuy√™n tham kh·∫£o v√† kh√¥ng thay th·∫ø cho ch·∫©n ƒëo√°n c·ªßa b√°c sƒ©. H√£y lu√¥n nh·∫Øc nh·ªü ng∆∞·ªùi d√πng c·∫ßn thƒÉm kh√°m t·∫°i c√°c c∆° s·ªü y t·∫ø. V·∫•n ƒë·ªÅ c·ªßa ng∆∞·ªùi d√πng l√†: "${userSymptom}"`;

                // T·∫°o payload cho API
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                
                // Th·ª±c hi·ªán fetch call v·ªõi exponential backoff ƒë·ªÉ x·ª≠ l√Ω l·ªói
                let response;
                let delay = 1000; // 1 gi√¢y
                for (let i = 0; i < 5; i++) {
                    try {
                        response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        if (response.status === 429) { // L·ªói qu√° nhi·ªÅu y√™u c·∫ßu
                            await new Promise(res => setTimeout(res, delay));
                            delay *= 2;
                            continue;
                        }
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        break;
                    } catch (e) {
                        console.error('Fetch failed, retrying...', e);
                        await new Promise(res => setTimeout(res, delay));
                        delay *= 2;
                        if (i === 4) throw e;
                    }
                }

                if (response.ok) {
                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        responseContent.textContent = text;
                        responseArea.classList.remove('hidden');
                    } else {
                        throw new Error('C·∫•u tr√∫c ph·∫£n h·ªìi kh√¥ng h·ª£p l·ªá t·ª´ API.');
                    }
                } else {
                    throw new Error('L·ªói khi g·ªçi API.');
                }

            } catch (error) {
                console.error('L·ªói:', error);
                errorMessage.classList.remove('hidden');
            } finally {
                // ƒê·∫∑t l·∫°i tr·∫°ng th√°i n√∫t v√† spinner
                consultButton.disabled = false;
                buttonText.textContent = 'T∆∞ v·∫•n t·ª´ chuy√™n gia YHCT ‚ú®';
                loadingSpinner.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
